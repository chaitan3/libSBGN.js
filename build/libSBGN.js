(function(){var f=!0,h=null,i=!1,j=this;
function aa(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";else if("function"==
b&&"undefined"==typeof a.call)return"object";return b}function k(a){return void 0!==a}function l(a){return"string"==typeof a}function m(a,b){var c=a.split("."),d=j;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)!c.length&&k(b)?d[e]=b:d=d[e]?d[e]:d[e]={}}function n(a,b){function c(){}c.prototype=b.prototype;a.L=b.prototype;a.prototype=new c};function o(a,b){for(var c in a)if(a[c]==b)return f;return i}function ba(a){for(var b in a)return i;return f}function ca(a){"data"in a&&delete a.data};var p={};m("sb.NodeType",p);p.UnspecifiedEntity="unspecified entity";p.SimpleChemical="simple chemical";p.Macromolecule="macromolecule";p.NucleicAcidFeature="nucleic acid feature";p.SimpleChemicalMultimer="simple chemical multimer";p.MacromoleculeMultimer="macromolecule multimer";p.NucleicAcidFeatureMultimer="nucleic acid feature multimer";p.Complex="complex";p.ComplexMultimer="complex multimer";p.SourceAndSink="source and sink";p.Perturbation="perturbation";p.BiologicalActivity="biological activity";
p.PerturbingAgent="perturbing agent";p.Compartment="compartment";p.Submap="submap";p.Tag="tag";p.Terminal="terminal";p.Process="process";p.OmittedProcess="omitted process";p.UncertainProcess="uncertain process";p.Association="association";p.Dissociation="dissociation";p.Phenotype="phenotype";p.And="and";p.Or="or";p.Not="not";p.StateVariable="state variable";p.UnitOfInformation="unit of information";p.Stoichiometry="stoichiometry";p.Entity="entity";p.Outcome="outcome";p.Observable="observable";
p.Interaction="interaction";p.InfluenceTarget="influence target";p.Annotation="annotation";p.VariableValue="variable value";p.ImplicitXor="implicit xor";p.Delay="delay";p.Existence="existence";p.Location="location";p.Cardinality="cardinality";function da(a){return o(p,a)}m("sb.NodeTypeHelper.isNodeTypeSupported",da);function ea(a){for(var b=0,c=(""+q).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),a=(""+a).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),d=Math.max(c.length,a.length),e=0;0==b&&e<d;e++){var g=c[e]||"",K=a[e]||"",x=RegExp("(\\d*)(\\D*)","g"),L=RegExp("(\\d*)(\\D*)","g");do{var s=x.exec(g)||["","",""],t=L.exec(K)||["","",""];if(0==s[0].length&&0==t[0].length)break;b=((0==s[1].length?0:parseInt(s[1],10))<(0==t[1].length?0:parseInt(t[1],10))?-1:(0==s[1].length?0:parseInt(s[1],10))>(0==t[1].length?
0:parseInt(t[1],10))?1:0)||((0==s[2].length)<(0==t[2].length)?-1:(0==s[2].length)>(0==t[2].length)?1:0)||(s[2]<t[2]?-1:s[2]>t[2]?1:0)}while(0==b)}return b};var r=Array.prototype,fa=r.indexOf?function(a,b,c){return r.indexOf.call(a,b,c)}:function(a,b,c){c=c==h?0:0>c?Math.max(0,a.length+c):c;if(l(a))return!l(b)||1!=b.length?-1:a.indexOf(b,c);for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},u=r.forEach?function(a,b,c){r.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=l(a)?a.split(""):a,g=0;g<d;g++)g in e&&b.call(c,e[g],g,a)},ga=r.filter?function(a,b,c){return r.filter.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=[],g=0,K=l(a)?a.split(""):
a,x=0;x<d;x++)if(x in K){var L=K[x];b.call(c,L,x,a)&&(e[g++]=L)}return e};function ha(a,b){return 0<=fa(a,b)}function v(a,b){ha(a,b)||a.push(b)};function w(a,b){this.e={};this.c=[];var c=arguments.length;if(1<c){if(c%2)throw Error("Uneven number of arguments");for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else if(a){var e;if(a instanceof w){y(a);d=a.c.concat();y(a);e=[];for(c=0;c<a.c.length;c++)e.push(a.e[a.c[c]])}else{var c=[],g=0;for(d in a)c[g++]=d;d=c;c=[];g=0;for(e in a)c[g++]=a[e];e=c}for(c=0;c<d.length;c++)this.set(d[c],e[c])}}w.prototype.i=0;
w.prototype.remove=function(a){return Object.prototype.hasOwnProperty.call(this.e,a)?(delete this.e[a],this.i--,this.c.length>2*this.i&&y(this),f):i};function y(a){if(a.i!=a.c.length){for(var b=0,c=0;b<a.c.length;){var d=a.c[b];Object.prototype.hasOwnProperty.call(a.e,d)&&(a.c[c++]=d);b++}a.c.length=c}if(a.i!=a.c.length){for(var e={},c=b=0;b<a.c.length;)d=a.c[b],Object.prototype.hasOwnProperty.call(e,d)||(a.c[c++]=d,e[d]=1),b++;a.c.length=c}}
w.prototype.get=function(a,b){return Object.prototype.hasOwnProperty.call(this.e,a)?this.e[a]:b};w.prototype.set=function(a,b){Object.prototype.hasOwnProperty.call(this.e,a)||(this.i++,this.c.push(a));this.e[a]=b};w.prototype.n=function(){return new w(this)};function z(){this.h=new w}m("sb.model.AttributeObject",z);z.prototype.a=function(a,b,c){if(k(b)){var d=this.h.get(a);this.h.set(a,b);c&&"id"==a&&(d&&c.r.remove(d),c.r.set(b,this));return this}return this.h.get(a)};z.prototype.attr=z.prototype.a;function A(a){this.h=new w;this.b=a;this.m=[];this.parent=h}n(A,z);m("sb.model.Element",A);A.prototype.id=function(a){if(k(a)){var b=this.b.element(a);if(b&&b!=this)throw Error("Given element id "+a+" already existed");}return this.a("id",a,this.b)};A.prototype.id=A.prototype.id;A.prototype.g=function(a){a.parent&&a.parent.removeChild(a);v(this.m,a);a.parent=this};A.prototype.addChild=A.prototype.g;A.prototype.removeChild=function(a){var b=this.m,c=fa(b,a);0<=c&&r.splice.call(b,c,1);a.parent=h};
A.prototype.removeChild=A.prototype.removeChild;A.prototype.children=function(){return this.m};A.prototype.children=A.prototype.children;function B(a){A.call(this,a)}n(B,A);m("sb.Port",B);function C(a){A.call(this,a)}n(C,A);m("sb.Node",C);C.prototype.type=function(a){if(k(a)&&!da(a))throw Error("Given node type "+a+" is not supported.");return this.a("type",a)};C.prototype.type=C.prototype.type;C.prototype.label=function(a){return this.a("label",a)};C.prototype.label=C.prototype.label;C.prototype.n=function(a){return this.a("clone",a)};C.prototype.clone=C.prototype.n;C.prototype.t=function(a){a=this.b.createNode(a);this.g(a);return a};C.prototype.createSubNode=C.prototype.t;
C.prototype.d=function(a){a=this.b.d(a);this.g(a);return a};C.prototype.createPort=C.prototype.d;var D={};m("sb.ArcType",D);D.Production="production";D.Consumption="consumption";D.Catalysis="catalysis";D.Modulation="modulation";D.Stimulation="stimulation";D.Inhibition="inhibition";D.Assignment="assignment";D.Interaction="interaction";D.AbsoluteInhibition="absolute inhibition";D.AbsoluteStimulation="absolute stimulation";D.PositiveInfluence="positive influence";D.NegativeInfluence="negative influence";D.UnknownInfluence="unknown influence";D.EquivalenceArc="equivalence arc";
D.NecessaryStimulation="necessary stimulation";D.LogicArc="logic arc";function ia(a){return o(D,a)}m("sb.ArcTypeHelper.isArcTypeSupported",ia);function E(a){A.call(this,a)}n(E,A);m("sb.Arc",E);E.prototype.type=function(a){if(k(a)&&!ia(a))throw Error("Given arc type "+a+" is not supported.");return this.a("type",a)};E.prototype.type=E.prototype.type;E.prototype.source=function(a){if(a&&l(a)){var b=this.b.element(a);if(!b)throw Error("Element "+a+" do not exist.");a=b}return this.a("source",a)};E.prototype.source=E.prototype.source;
E.prototype.target=function(a){if(a&&l(a)){var b=this.b.element(a);if(!b)throw Error("Element "+a+" do not exist.");a=b}return this.a("target",a)};E.prototype.target=E.prototype.target;E.prototype.d=function(a){a=this.b.d(a);this.g(a);return a};E.prototype.createPort=E.prototype.d;function F(a){this.h=new w;this.id=a;this.H=this.z=this.G=1;this.r=new w;this.s=[];this.l=[]}n(F,z);m("sb.Document",F);F.prototype.createNode=function(a){a=a?a:ja(this);a=(new C(this)).id(a);v(this.s,a);return a};F.prototype.createNode=F.prototype.createNode;function ja(a){var b="node"+a.G++;return a.element(b)?ja(a):b}F.prototype.u=function(a){return a?ga(this.s,function(a){return a.parent?i:f}):this.s};F.prototype.nodes=F.prototype.u;
F.prototype.F=function(a){a=this.element(a);return a instanceof C?a:h};F.prototype.node=F.prototype.F;F.prototype.element=function(a){return this.r.get(a)};F.prototype.p=function(a){a=a?a:ka(this);a=(new E(this)).id(a);v(this.l,a);return a};F.prototype.createArc=F.prototype.p;F.prototype.C=function(a,b){var c=this.p();c.source(a).target(b);return c};F.prototype.connect=F.prototype.C;function ka(a){var b="arc"+a.z++;return a.element(b)?ka(a):b}F.prototype.A=function(){return this.l};
F.prototype.arcs=F.prototype.A;F.prototype.arc=function(a){a=this.element(a);return a instanceof E?a:h};F.prototype.arc=F.prototype.arc;function la(a){var b="port"+a.H++;return a.element(b)?la(a):b}F.prototype.d=function(a){a=a?a:la(this);return(new B(this)).id(a)};F.prototype.createPort=F.prototype.d;F.prototype.lang=function(a){if(k(a)&&!o(ma,a))throw Error("Given SBGN language type "+a+" is not supported.");return this.a("language",a)};var ma={I:"activity flow",J:"entity relationship",K:"process description"};
m("sb.Language",ma);function na(a,b){this.x=k(a)?a:0;this.y=k(b)?b:0}m("sb.Point",na);function G(a,b,c,d){this.x=k(a)?a:0;this.y=k(b)?b:0;this.width=k(c)?c:0;this.height=k(d)?d:0}m("sb.Box",G);G.prototype.contains=function(a){return a.x>=this.x&&a.y>=this.y&&this.x+this.width>=a.x+a.width&&this.y+this.height>=a.y+a.height};var H,I,J,M;function oa(){return j.navigator?j.navigator.userAgent:h}M=J=I=H=i;var N;if(N=oa()){var pa=j.navigator;H=0==N.indexOf("Opera");I=!H&&-1!=N.indexOf("MSIE");J=!H&&-1!=N.indexOf("WebKit");M=!H&&!J&&"Gecko"==pa.product}var O=I,P=M,qa=J,q;
a:{var Q="",R;if(H&&j.opera)var S=j.opera.version,Q="function"==typeof S?S():S;else if(P?R=/rv\:([^\);]+)(\)|;)/:O?R=/MSIE\s+([^\);]+)(\)|;)/:qa&&(R=/WebKit\/(\S+)/),R)var ra=R.exec(oa()),Q=ra?ra[1]:"";if(O){var T,sa=j.document;T=sa?sa.documentMode:void 0;if(T>parseFloat(Q)){q=""+T;break a}}q=Q}var U={},ta={};function ua(){return ta[9]||(ta[9]=O&&!!document.documentMode&&9<=document.documentMode)};!O||ua();if(P||O)if((!O||!ua())&&P)U["1.9.1"]||(U["1.9.1"]=0<=ea("1.9.1"));O&&(U["9"]||(U["9"]=0<=ea("9")));function va(){}
function wa(a){"\ufeff"==a.charAt(0)&&(a=a.substr(1,a.length));new w;if("undefined"!=typeof DOMParser)a=(new DOMParser).parseFromString(a,"application/xml");else if("undefined"!=typeof ActiveXObject){var b=new ActiveXObject("MSXML2.DOMDocument");if(b){b.resolveExternals=i;b.validateOnParse=i;try{b.setProperty("ProhibitDTD",f),b.setProperty("MaxXMLSize",2048),b.setProperty("MaxElementDepth",256)}catch(c){}}b.loadXML(a);a=b}else throw Error("Your browser does not support loading xml documents");return a}
function xa(a,b){ya(a,b);u(b.childNodes,function(a){1==a.nodeType&&xa(this,a)},a);za(a,b)};function V(){this.j=[]}V.prototype.push=function(a){this.j.push(a)};V.prototype.pop=function(){return this.j.pop()};function W(){this.o=this.b=this.q=this.f=h}n(W,va);m("sb.io.SbgnReader",W);W.prototype.v=function(a){this.f=new V;this.b=new F;this.o=[];this.q=[];xa(this,wa(a).documentElement);u(this.q,function(a){var c=this.b.arc(a.getAttribute("id")),d=a.getAttribute("target"),a=a.getAttribute("source");c.source(a).target(d)},this);return this.b};W.prototype.parseText=W.prototype.v;
function ya(a,b){var c=b.tagName,c=c?c.toLocaleLowerCase():h,d=b.getAttribute("id"),e=a.f.j[a.f.j.length-1];if("glyph"==c)d=e instanceof C?e.t(d):a.b.createNode(d),c=b.getAttribute("class"),d.type(c),a.f.push(d),"compartment"==c&&v(a.o,d);else if("port"==c)(e instanceof C||e instanceof E)&&e.d(d);else if("arc"==c)c=a.b.p(d),d||b.setAttribute("id",c.id()),d=b.getAttribute("class"),c.type(d),a.f.push(c),v(a.q,b);else if("label"==c)e.label(b.getAttribute("text"));else if("bbox"==c){var g=new G(Number(b.getAttribute("x")),
Number(b.getAttribute("y")),Number(b.getAttribute("w")),Number(b.getAttribute("h")));"label"==b.parentNode.tagName.toLocaleLowerCase()?e.a("label.pos",g):(e.a("box",g),e instanceof C&&"compartment"!=e.type()&&u(a.o,function(a){a.a("box").contains(g)&&a.g(e)},a))}else"start"==c||"end"==c?e instanceof E&&e.a(c,new na(Number(b.getAttribute("x")),Number(b.getAttribute("y")))):"map"==c?((d=b.getAttribute("language"))&&a.b.lang(d),a.f.push(a.b)):"entity"==c&&e.a("entity",b.getAttribute("name"))}
function za(a,b){var c=b.tagName;("glyph"==c||"arc"==c||"map"==c)&&a.f.pop()};function X(a,b,c){this.url=a;this.B=c;this.D=Aa(this);c=document.createElement("script");c.setAttribute("type","text/javascript");var d="",b=b||{},e;for(e in b)b.hasOwnProperty(e)&&(d+=encodeURIComponent(e)+"="+encodeURIComponent(b[e])+"&");c.setAttribute("src",a+"?"+d+"callback=sb.io.Jsonp."+this.D);this.w=document.getElementsByTagName("head")[0].appendChild(c)}m("sb.io.Jsonp",X);X.call=function(a,b,c){new X(a,b,c)};
function Aa(a){for(var b="",c=0;15>c;c++)b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(Math.floor(52*Math.random()));X[b]=function(c){a.B(c);delete X[b];a.w.parentNode.removeChild(a.w)};return b};var Y={};m("sb.sbo.NodeTypeMapping",Y);Y["unspecified entity"]=285;Y.compartment=290;Y.macromolecule=245;Y["macromolecule multimer"]=420;Y["simple chemical"]=247;Y["simple chemical multimer"]=421;Y.complex=253;Y["complex multimer"]=418;Y.process=375;Y["omitted process"]=379;Y["uncertain process"]=396;Y.annotation=110003;Y.phenotype=358;Y["nucleic acid feature"]=250;Y["nucleic acid feature multimer"]=250;Y.association=177;Y.dissociation=180;Y.entity=245;Y.submap=395;Y.terminal=110004;
Y["perturbing agent"]=405;Y["variable value"]=110001;Y["implicit xor"]=-1;Y.tag=110002;Y.and=173;Y.or=174;Y.not=238;Y.delay=225;Y["source and sink"]=291;Y.perturbation=405;Y["biological activity"]=412;var Z={};m("sb.sbo.ArcTypeMapping",Z);Z.production=393;Z["equivalence arc"]=15;Z["logic arc"]=15;Z["necessary stimulation"]=461;Z.assignment=464;Z.interaction=342;Z["absolute inhibition"]=407;Z.modulation=168;Z.inhibition=169;Z["absolute stimulation"]=411;Z["unknown influence"]=168;
Z["positive influence"]=170;Z["negative influence"]=169;Z.stimulation=170;Z.catalysis=172;Z.consumption=15;Z.production=393;Z.catalysis=13;function Ba(){this.k=void 0}function Ca(a){var b=[];Da(new Ba,a,b);return b.join("")}
function Da(a,b,c){switch(typeof b){case "string":Ea(b,c);break;case "number":c.push(isFinite(b)&&!isNaN(b)?b:"null");break;case "boolean":c.push(b);break;case "undefined":c.push("null");break;case "object":if(b==h){c.push("null");break}if("array"==aa(b)){var d=b.length;c.push("[");for(var e="",g=0;g<d;g++)c.push(e),e=b[g],Da(a,a.k?a.k.call(b,""+g,e):e,c),e=",";c.push("]");break}c.push("{");d="";for(g in b)Object.prototype.hasOwnProperty.call(b,g)&&(e=b[g],"function"!=typeof e&&(c.push(d),Ea(g,c),
c.push(":"),Da(a,a.k?a.k.call(b,g,e):e,c),d=","));c.push("}");break;case "function":break;default:throw Error("Unknown type: "+typeof b);}}var Fa={'"':'\\"',"\\":"\\\\","/":"\\/","\u0008":"\\b","\u000c":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\u000b"},Ga=/\uffff/.test("\uffff")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g;
function Ea(a,b){b.push('"',a.replace(Ga,function(a){if(a in Fa)return Fa[a];var b=a.charCodeAt(0),e="\\u";16>b?e+="000":256>b?e+="00":4096>b&&(e+="0");return Fa[a]=e+b.toString(16)}),'"')};function Ha(){}m("sb.io.JsbgnWriter",Ha);var $=[];$["entity relationship"]="ER";$["activity flow"]="AF";$["process description"]="PD";
Ha.prototype.write=function(a){var b={nodes:[],edges:[]};a.lang()&&(b.sbgnlang=$[a.lang()]);u(a.u(),function(a){if(!(a instanceof B)&&!ha(["unit of information","state variable"],a.type())){var d={};d.id=a.id();d.sbo=Y[a.type()];d.is_abstract=i;var e={};d.data=e;a.n()&&(e.clone=f);a.label()&&(e.label=a.label());var g=a.a("box");g&&(e.x=g.x,e.y=g.y,e.width=g.width,e.height=g.height);u(a.children(),function(a){if(!(a instanceof B))if(a.type()=="unit of information"){e.unitofinformation||(e.unitofinformation=
[]);v(e.unitofinformation,a.label()?a.label():"")}else if(a.type()!="state variable"){e.subnodes||(e.subnodes=[]);v(e.subnodes,a.id())}},this);ba(e)&&ca(d);v(b.nodes,d)}},this);u(a.l,function(a){var d={};d.id=a.id();d.sbo=Z[a.type()];d.source=a.source().id();d.target=a.target().id();a={};d.data=a;ba(a)&&ca(d);v(b.edges,d)},this);return Ca(b)};function Ia(a,b){var c;if("sbgn"==b)c=new W;else throw Error("Format "+b+" not supported");return c.v(a)}m("sb.io.read",Ia);m("sb.io.readUrl",function(a,b,c){new X("http://chemhack.com/jsonp/ba-simple-proxy.php",{url:a},function(a){200==a.status.http_code&&(a=Ia(a.contents,b),c(a))})});m("sb.io.write",function(a,b){var c;if("jsbgn"==b)c=new Ha;else throw Error("Format "+b+" not supported");return c.write(a)});})();
